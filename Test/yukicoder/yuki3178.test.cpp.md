---
data:
  _extendedDependsOn:
  - icon: ':question:'
    path: DataStructure/segtree_dual.hpp
    title: "\u53CC\u5BFE\u30BB\u30B0\u30E1\u30F3\u30C8\u6728"
  - icon: ':x:'
    path: Graph/csr.hpp
    title: Compressed Sparse Row (CSR)
  _extendedRequiredBy: []
  _extendedVerifiedWith: []
  _isVerificationFailed: true
  _pathExtension: cpp
  _verificationStatusIcon: ':x:'
  attributes: {}
  bundledCode: "#line 1 \"Test/yukicoder/yuki3178.test.cpp\"\n#define PROBLEM \"https://yukicoder.me/problems/no/3187\"\
    \r\n\r\n#include <bits/stdc++.h>\r\n#include <atcoder/all>\r\n#include <Graph/csr.hpp>\r\
    \n#include <DataStructure/segtree_dual.hpp>\r\nusing namespace std;\r\nusing mint\
    \ = atcoder::modint;\r\n\r\nusing S = mint;\r\n// bf \u306B af \u3092\u4F5C\u7528\
    \u3055\u305B\u305F\u6642\u306E\u5909\u5316\r\nS mapping(S af, S bf){ return bf\
    \ + af; }\r\n// \u6052\u7B49\u5199\u50CF\r\nS id(){ return 0; }\r\n\r\nint main()\
    \ {\r\n    ios::sync_with_stdio(false);\r\n    cin.tie(0);\r\n    int n, p;\r\n\
    \    cin >> n >> p;\r\n    mint::set_mod(p);\r\n    csr<int> dv(n + 1);\r\n  \
    \  for(int i = 1; i <= n; i++){\r\n        for(int j = 2 * i; j <= n; j += i)\
    \ dv.add_edge(j, i);\r\n    }\r\n    dv.build();\r\n    vector<mint> coef(n +\
    \ 1), prv(n + 1);\r\n    mint ans;\r\n    int mn = n;\r\n    for(int i = 1; i\
    \ <= n; i++){\r\n        int v = n - (n % i);\r\n        coef[v]++;\r\n      \
    \  mn = min(mn, v);\r\n    }\r\n    dual_segtree<S, mapping, id> seg(n + 1);\r\
    \n    prv[n] = 1;\r\n    for(int i = n; i >= 3; i--){\r\n        mint div = mint::raw(i\
    \ - 1 - dv[i].size()).inv();\r\n        ans += prv[i] * mint(i) * div;\r\n   \
    \     seg.apply(mn, i, prv[i] * div);\r\n        for(int j = 0; j < dv[i].size();\
    \ j++){\r\n            int d = dv[i][j];\r\n            int v = i - d;\r\n   \
    \         prv[v] += seg[v] * coef[v];\r\n            seg[v] = 0;\r\n         \
    \   coef[v]++;\r\n            mn = min(mn, v);\r\n        }\r\n    }\r\n    cout\
    \ << ans.val() << '\\n';\r\n}\n"
  code: "#define PROBLEM \"https://yukicoder.me/problems/no/3187\"\r\n\r\n#include\
    \ <bits/stdc++.h>\r\n#include <atcoder/all>\r\n#include <Graph/csr.hpp>\r\n#include\
    \ <DataStructure/segtree_dual.hpp>\r\nusing namespace std;\r\nusing mint = atcoder::modint;\r\
    \n\r\nusing S = mint;\r\n// bf \u306B af \u3092\u4F5C\u7528\u3055\u305B\u305F\u6642\
    \u306E\u5909\u5316\r\nS mapping(S af, S bf){ return bf + af; }\r\n// \u6052\u7B49\
    \u5199\u50CF\r\nS id(){ return 0; }\r\n\r\nint main() {\r\n    ios::sync_with_stdio(false);\r\
    \n    cin.tie(0);\r\n    int n, p;\r\n    cin >> n >> p;\r\n    mint::set_mod(p);\r\
    \n    csr<int> dv(n + 1);\r\n    for(int i = 1; i <= n; i++){\r\n        for(int\
    \ j = 2 * i; j <= n; j += i) dv.add_edge(j, i);\r\n    }\r\n    dv.build();\r\n\
    \    vector<mint> coef(n + 1), prv(n + 1);\r\n    mint ans;\r\n    int mn = n;\r\
    \n    for(int i = 1; i <= n; i++){\r\n        int v = n - (n % i);\r\n       \
    \ coef[v]++;\r\n        mn = min(mn, v);\r\n    }\r\n    dual_segtree<S, mapping,\
    \ id> seg(n + 1);\r\n    prv[n] = 1;\r\n    for(int i = n; i >= 3; i--){\r\n \
    \       mint div = mint::raw(i - 1 - dv[i].size()).inv();\r\n        ans += prv[i]\
    \ * mint(i) * div;\r\n        seg.apply(mn, i, prv[i] * div);\r\n        for(int\
    \ j = 0; j < dv[i].size(); j++){\r\n            int d = dv[i][j];\r\n        \
    \    int v = i - d;\r\n            prv[v] += seg[v] * coef[v];\r\n           \
    \ seg[v] = 0;\r\n            coef[v]++;\r\n            mn = min(mn, v);\r\n  \
    \      }\r\n    }\r\n    cout << ans.val() << '\\n';\r\n}"
  dependsOn:
  - Graph/csr.hpp
  - DataStructure/segtree_dual.hpp
  isVerificationFile: true
  path: Test/yukicoder/yuki3178.test.cpp
  requiredBy: []
  timestamp: '2025-06-21 08:49:58+09:00'
  verificationStatus: TEST_WRONG_ANSWER
  verifiedWith: []
documentation_of: Test/yukicoder/yuki3178.test.cpp
layout: document
redirect_from:
- /verify/Test/yukicoder/yuki3178.test.cpp
- /verify/Test/yukicoder/yuki3178.test.cpp.html
title: Test/yukicoder/yuki3178.test.cpp
---
