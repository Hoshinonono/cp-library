---
data:
  _extendedDependsOn:
  - icon: ':heavy_check_mark:'
    path: DataStructure/segtree_dual.hpp
    title: "\u53CC\u5BFE\u30BB\u30B0\u30E1\u30F3\u30C8\u6728"
  - icon: ':heavy_check_mark:'
    path: Graph/csr.hpp
    title: Compressed Sparse Row (CSR)
  - icon: ':heavy_check_mark:'
    path: atcoder/convolution.hpp
    title: atcoder/convolution.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/dsu.hpp
    title: atcoder/dsu.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/fenwicktree.hpp
    title: atcoder/fenwicktree.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/internal_bit.hpp
    title: atcoder/internal_bit.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/internal_csr.hpp
    title: atcoder/internal_csr.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/internal_math.hpp
    title: atcoder/internal_math.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/internal_queue.hpp
    title: atcoder/internal_queue.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/internal_scc.hpp
    title: atcoder/internal_scc.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/internal_type_traits.hpp
    title: atcoder/internal_type_traits.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/lazysegtree.hpp
    title: atcoder/lazysegtree.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/math.hpp
    title: atcoder/math.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/maxflow.hpp
    title: atcoder/maxflow.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/mincostflow.hpp
    title: atcoder/mincostflow.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/modint.hpp
    title: atcoder/modint.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/scc.hpp
    title: atcoder/scc.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/segtree.hpp
    title: atcoder/segtree.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/string.hpp
    title: atcoder/string.hpp
  - icon: ':heavy_check_mark:'
    path: atcoder/twosat.hpp
    title: atcoder/twosat.hpp
  _extendedRequiredBy: []
  _extendedVerifiedWith: []
  _isVerificationFailed: false
  _pathExtension: cpp
  _verificationStatusIcon: ':heavy_check_mark:'
  attributes:
    '*NOT_SPECIAL_COMMENTS*': ''
    PROBLEM: https://yukicoder.me/problems/no/3187
    links:
    - https://yukicoder.me/problems/no/3187
  bundledCode: "#line 1 \"Test/yukicoder/yuki3178.test.cpp\"\n#define PROBLEM \"https://yukicoder.me/problems/no/3187\"\
    \r\n\r\n#include <bits/stdc++.h>\r\n#include <atcoder/all>\r\n#include <Graph/csr.hpp>\r\
    \n#include <DataStructure/segtree_dual.hpp>\r\nusing namespace std;\r\nusing mint\
    \ = atcoder::modint;\r\nusing S = mint;\r\n// bf \u306B af \u3092\u4F5C\u7528\u3055\
    \u305B\u305F\u6642\u306E\u5909\u5316\r\nS mapping(S af, S bf){ return bf + af;\
    \ }\r\n// \u6052\u7B49\u5199\u50CF\r\nS id(){ return 0; }\r\n \r\nint main() {\r\
    \n    ios::sync_with_stdio(false);\r\n    cin.tie(0);\r\n    int n, p;\r\n   \
    \ cin >> n >> p;\r\n    mint::set_mod(p);\r\n    csr<int> dv(n + 1);\r\n    for(int\
    \ i = 1; i <= n; i++){\r\n        for(int j = 2 * i; j <= n; j += i) dv.add_edge(j,\
    \ i);\r\n    }\r\n    dv.build();\r\n    vector<mint> coef(n + 1), prv(n + 1);\r\
    \n    mint ans;\r\n    int mn = n;\r\n    for(int i = 1; i <= n; i++){\r\n   \
    \     int v = n - (n % i);\r\n        coef[v]++;\r\n        mn = min(mn, v);\r\
    \n    }\r\n    dual_segtree<S, mapping, id> seg(n + 1);\r\n    prv[n] = 1;\r\n\
    \    for(int i = n; i >= 3; i--){\r\n        mint div = mint::raw(i - 1 - dv[i].size()).inv();\r\
    \n        ans += prv[i] * mint(i) * div;\r\n        seg.apply(mn, i, prv[i] *\
    \ div);\r\n        for(int j = 0; j < dv[i].size(); j++){\r\n            int d\
    \ = dv[i][j];\r\n            int v = i - d;\r\n            prv[v] += seg[v] *\
    \ coef[v];\r\n            seg[v] = 0;\r\n            coef[v]++;\r\n          \
    \  mn = min(mn, v);\r\n        }\r\n    }\r\n    cout << ans.val() << '\\n';\r\
    \n}\r\n"
  code: "#define PROBLEM \"https://yukicoder.me/problems/no/3187\"\r\n\r\n#include\
    \ <bits/stdc++.h>\r\n#include <atcoder/all>\r\n#include <Graph/csr.hpp>\r\n#include\
    \ <DataStructure/segtree_dual.hpp>\r\nusing namespace std;\r\nusing mint = atcoder::modint;\r\
    \nusing S = mint;\r\n// bf \u306B af \u3092\u4F5C\u7528\u3055\u305B\u305F\u6642\
    \u306E\u5909\u5316\r\nS mapping(S af, S bf){ return bf + af; }\r\n// \u6052\u7B49\
    \u5199\u50CF\r\nS id(){ return 0; }\r\n \r\nint main() {\r\n    ios::sync_with_stdio(false);\r\
    \n    cin.tie(0);\r\n    int n, p;\r\n    cin >> n >> p;\r\n    mint::set_mod(p);\r\
    \n    csr<int> dv(n + 1);\r\n    for(int i = 1; i <= n; i++){\r\n        for(int\
    \ j = 2 * i; j <= n; j += i) dv.add_edge(j, i);\r\n    }\r\n    dv.build();\r\n\
    \    vector<mint> coef(n + 1), prv(n + 1);\r\n    mint ans;\r\n    int mn = n;\r\
    \n    for(int i = 1; i <= n; i++){\r\n        int v = n - (n % i);\r\n       \
    \ coef[v]++;\r\n        mn = min(mn, v);\r\n    }\r\n    dual_segtree<S, mapping,\
    \ id> seg(n + 1);\r\n    prv[n] = 1;\r\n    for(int i = n; i >= 3; i--){\r\n \
    \       mint div = mint::raw(i - 1 - dv[i].size()).inv();\r\n        ans += prv[i]\
    \ * mint(i) * div;\r\n        seg.apply(mn, i, prv[i] * div);\r\n        for(int\
    \ j = 0; j < dv[i].size(); j++){\r\n            int d = dv[i][j];\r\n        \
    \    int v = i - d;\r\n            prv[v] += seg[v] * coef[v];\r\n           \
    \ seg[v] = 0;\r\n            coef[v]++;\r\n            mn = min(mn, v);\r\n  \
    \      }\r\n    }\r\n    cout << ans.val() << '\\n';\r\n}\r\n"
  dependsOn:
  - atcoder/convolution.hpp
  - atcoder/internal_bit.hpp
  - atcoder/modint.hpp
  - atcoder/internal_math.hpp
  - atcoder/internal_type_traits.hpp
  - atcoder/dsu.hpp
  - atcoder/fenwicktree.hpp
  - atcoder/lazysegtree.hpp
  - atcoder/math.hpp
  - atcoder/maxflow.hpp
  - atcoder/internal_queue.hpp
  - atcoder/mincostflow.hpp
  - atcoder/internal_csr.hpp
  - atcoder/scc.hpp
  - atcoder/internal_scc.hpp
  - atcoder/segtree.hpp
  - atcoder/string.hpp
  - atcoder/twosat.hpp
  - Graph/csr.hpp
  - DataStructure/segtree_dual.hpp
  isVerificationFile: true
  path: Test/yukicoder/yuki3178.test.cpp
  requiredBy: []
  timestamp: '2025-11-08 08:40:41+09:00'
  verificationStatus: TEST_ACCEPTED
  verifiedWith: []
documentation_of: Test/yukicoder/yuki3178.test.cpp
layout: document
redirect_from:
- /verify/Test/yukicoder/yuki3178.test.cpp
- /verify/Test/yukicoder/yuki3178.test.cpp.html
title: Test/yukicoder/yuki3178.test.cpp
---
